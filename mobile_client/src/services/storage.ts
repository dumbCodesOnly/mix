/**\n * Local storage service for persistent data management.\n *\n * This module provides utilities for storing and retrieving user preferences,\n * settings, and other persistent data.\n */\n\nimport AsyncStorage from '@react-native-async-storage/async-storage';\n\ninterface StorageKeys {\n  API_BASE_URL: string;\n  USER_PREFERENCES: string;\n  RECENT_PROMPTS: string;\n  FAVORITE_IMAGES: string;\n  SETTINGS: string;\n}\n\nconst STORAGE_KEYS: StorageKeys = {\n  API_BASE_URL: '@ai_platform_api_url',\n  USER_PREFERENCES: '@ai_platform_preferences',\n  RECENT_PROMPTS: '@ai_platform_recent_prompts',\n  FAVORITE_IMAGES: '@ai_platform_favorites',\n  SETTINGS: '@ai_platform_settings',\n};\n\ninterface UserPreferences {\n  theme: 'light' | 'dark';\n  language: string;\n  notifications: boolean;\n}\n\ninterface AppSettings {\n  defaultModel?: string;\n  imageQuality: 'low' | 'medium' | 'high';\n  autoCache: boolean;\n  offlineMode: boolean;\n}\n\nclass StorageService {\n  /**\n   * Save the API base URL.\n   */\n  async saveAPIBaseURL(url: string): Promise<void> {\n    try {\n      await AsyncStorage.setItem(STORAGE_KEYS.API_BASE_URL, url);\n    } catch (error) {\n      console.error('Failed to save API base URL:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Get the saved API base URL.\n   */\n  async getAPIBaseURL(): Promise<string | null> {\n    try {\n      return await AsyncStorage.getItem(STORAGE_KEYS.API_BASE_URL);\n    } catch (error) {\n      console.error('Failed to get API base URL:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Save user preferences.\n   */\n  async savePreferences(preferences: UserPreferences): Promise<void> {\n    try {\n      await AsyncStorage.setItem(\n        STORAGE_KEYS.USER_PREFERENCES,\n        JSON.stringify(preferences)\n      );\n    } catch (error) {\n      console.error('Failed to save preferences:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Get user preferences.\n   */\n  async getPreferences(): Promise<UserPreferences | null> {\n    try {\n      const data = await AsyncStorage.getItem(STORAGE_KEYS.USER_PREFERENCES);\n      return data ? JSON.parse(data) : null;\n    } catch (error) {\n      console.error('Failed to get preferences:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Save app settings.\n   */\n  async saveSettings(settings: AppSettings): Promise<void> {\n    try {\n      await AsyncStorage.setItem(\n        STORAGE_KEYS.SETTINGS,\n        JSON.stringify(settings)\n      );\n    } catch (error) {\n      console.error('Failed to save settings:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Get app settings.\n   */\n  async getSettings(): Promise<AppSettings | null> {\n    try {\n      const data = await AsyncStorage.getItem(STORAGE_KEYS.SETTINGS);\n      return data ? JSON.parse(data) : null;\n    } catch (error) {\n      console.error('Failed to get settings:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Add a prompt to recent prompts.\n   */\n  async addRecentPrompt(prompt: string): Promise<void> {\n    try {\n      const recentData = await AsyncStorage.getItem(STORAGE_KEYS.RECENT_PROMPTS);\n      let prompts: string[] = recentData ? JSON.parse(recentData) : [];\n\n      // Remove if already exists and add to front\n      prompts = prompts.filter((p) => p !== prompt);\n      prompts.unshift(prompt);\n\n      // Keep only last 20 prompts\n      prompts = prompts.slice(0, 20);\n\n      await AsyncStorage.setItem(\n        STORAGE_KEYS.RECENT_PROMPTS,\n        JSON.stringify(prompts)\n      );\n    } catch (error) {\n      console.error('Failed to add recent prompt:', error);\n    }\n  }\n\n  /**\n   * Get recent prompts.\n   */\n  async getRecentPrompts(): Promise<string[]> {\n    try {\n      const data = await AsyncStorage.getItem(STORAGE_KEYS.RECENT_PROMPTS);\n      return data ? JSON.parse(data) : [];\n    } catch (error) {\n      console.error('Failed to get recent prompts:', error);\n      return [];\n    }\n  }\n\n  /**\n   * Clear recent prompts.\n   */\n  async clearRecentPrompts(): Promise<void> {\n    try {\n      await AsyncStorage.removeItem(STORAGE_KEYS.RECENT_PROMPTS);\n    } catch (error) {\n      console.error('Failed to clear recent prompts:', error);\n    }\n  }\n\n  /**\n   * Save favorite image metadata.\n   */\n  async addFavoriteImage(imageId: string, metadata: Record<string, unknown>): Promise<void> {\n    try {\n      const favoritesData = await AsyncStorage.getItem(STORAGE_KEYS.FAVORITE_IMAGES);\n      let favorites: Record<string, Record<string, unknown>> = favoritesData\n        ? JSON.parse(favoritesData)\n        : {};\n\n      favorites[imageId] = {\n        ...metadata,\n        savedAt: new Date().toISOString(),\n      };\n\n      await AsyncStorage.setItem(\n        STORAGE_KEYS.FAVORITE_IMAGES,\n        JSON.stringify(favorites)\n      );\n    } catch (error) {\n      console.error('Failed to add favorite image:', error);\n    }\n  }\n\n  /**\n   * Get favorite images.\n   */\n  async getFavoriteImages(): Promise<Record<string, Record<string, unknown>>> {\n    try {\n      const data = await AsyncStorage.getItem(STORAGE_KEYS.FAVORITE_IMAGES);\n      return data ? JSON.parse(data) : {};\n    } catch (error) {\n      console.error('Failed to get favorite images:', error);\n      return {};\n    }\n  }\n\n  /**\n   * Remove a favorite image.\n   */\n  async removeFavoriteImage(imageId: string): Promise<void> {\n    try {\n      const favoritesData = await AsyncStorage.getItem(STORAGE_KEYS.FAVORITE_IMAGES);\n      if (favoritesData) {\n        let favorites: Record<string, Record<string, unknown>> = JSON.parse(favoritesData);\n        delete favorites[imageId];\n        await AsyncStorage.setItem(\n          STORAGE_KEYS.FAVORITE_IMAGES,\n          JSON.stringify(favorites)\n        );\n      }\n    } catch (error) {\n      console.error('Failed to remove favorite image:', error);\n    }\n  }\n\n  /**\n   * Clear all storage.\n   */\n  async clearAll(): Promise<void> {\n    try {\n      await AsyncStorage.multiRemove(Object.values(STORAGE_KEYS));\n    } catch (error) {\n      console.error('Failed to clear all storage:', error);\n    }\n  }\n}\n\n// Global storage service instance\nlet storageService: StorageService | null = null;\n\n/**\n * Get or create the global storage service instance.\n */\nexport function getStorageService(): StorageService {\n  if (!storageService) {\n    storageService = new StorageService();\n  }\n  return storageService;\n}\n\nexport default getStorageService;\nexport type { UserPreferences, AppSettings };\n
