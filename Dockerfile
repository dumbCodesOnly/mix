# Multi-stage build for AI Platform Backend\n\n# Stage 1: Builder\nFROM python:3.11-slim as builder\n\nWORKDIR /app\n\n# Install build dependencies\nRUN apt-get update && apt-get install -y --no-install-recommends \\\n    build-essential \\\n    && rm -rf /var/lib/apt/lists/*\n\n# Copy requirements\nCOPY requirements.txt .\n\n# Install Python dependencies\nRUN pip install --no-cache-dir --user -r requirements.txt\n\n# Stage 2: Runtime\nFROM python:3.11-slim\n\nWORKDIR /app\n\n# Install runtime dependencies\nRUN apt-get update && apt-get install -y --no-install-recommends \\\n    libsm6 \\\n    libxext6 \\\n    libxrender-dev \\\n    && rm -rf /var/lib/apt/lists/*\n\n# Copy Python dependencies from builder\nCOPY --from=builder /root/.local /root/.local\n\n# Copy application code\nCOPY app/ ./app/\nCOPY .env.example .env\n\n# Set environment variables\nENV PATH=/root/.local/bin:$PATH \\\n    PYTHONUNBUFFERED=1 \\\n    PYTHONDONTWRITEBYTECODE=1\n\n# Health check\nHEALTHCHECK --interval=30s --timeout=10s --start-period=40s --retries=3 \\\n    CMD python -c \"import requests; requests.get('http://localhost:8000/health')\"\n\n# Expose port\nEXPOSE 8000\n\n# Start the application\nCMD [\"uvicorn\", \"app.main:app\", \"--host\", \"0.0.0.0\", \"--port\", \"8000\"]\n
